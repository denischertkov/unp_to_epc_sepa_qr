# UNP/UPN → EPC QR (Revolut)

Программа извлекает платёжные данные из **содержимого UNP/UPN QR-кодов** в PDF (словенские платёжные поручения) и формирует новый PDF с **EPC QR-кодами** (формат SEPA, поддерживается Revolut и другими EU-банками) и **реестром распознанных платежей** (суммы и итог).

## Как это работает

1. Из PDF извлекаются **изображения QR-кодов**, каждый декодируется в строку.
2. Строка разбирается как **UPN QR** (формат upn-qr.si): поля через `\n`, первая строка `UPNQR`. Из них берутся IBAN, сумма, референс, получатель, назначение.
3. Если **UNP/UPN QR-кодов в PDF нет** или их не удаётся прочитать, программа завершается с сообщением об этом (парсинг текста не используется).

На основе распознанных платежей:
- для каждого строится строка **EPC QR** (BCD/002/SCT) и генерируется изображение QR;
- формируется **итоговый PDF**: титул, реестр (таблица с суммами и итогом), затем для каждого платежа блок: **слева** — QR-код, **справа** — компактное описание (Recipient, IBAN, сумма, референс, назначение). Платежи визуально разделены (рамка и отступ между блоками).

## Зависимости

```bash
pip install -r requirements.txt
```

Для чтения UNP QR из PDF нужна системная библиотека **ZBar** (для `pyzbar`):

- **macOS:** `brew install zbar`
- **Ubuntu/Debian:** `sudo apt install libzbar0`
- **Windows:** см. [pyzbar](https://github.com/NaturalHistoryMuseum/pyzbar)

Без ZBar программа не сможет извлечь данные из QR и сообщит об отсутствии UNP кодов.

## Использование

```bash
python main.py vhodni_placilni_nalogi.pdf -o izhod_epc_qr.pdf
```

- `vhodni_placilni_nalogi.pdf` — PDF с платёжными поручениями (с QR и/или текстом).
- `-o izhod_epc_qr.pdf` — выходной PDF (по умолчанию: к имени входного файла добавляется `_epc_qr.pdf`).
- `-d` — вывод отладочной информации (извлечённый текст или факт чтения из QR, список платежей).

## Формат UPN QR (содержимое UNP-кода)

Строка после декодирования QR разбирается по строкам (разделитель `\n`):

- Строка 0: `UPNQR`
- Строки 5–7: плательщик (имя, улица, город)
- Строка 8: сумма (11 цифр, последние 2 — копейки)
- Строки 11–12: код и текст назначения
- Строка 13: срок платежа
- Строки 14–15: IBAN и референс получателя
- Строки 16–18: получатель (имя, улица, город)

Используется порядок полей по [upn-qr.si](https://www.upn-qr.si/) / NavodilaZaProgramerjeUPNQR.

## Лицензия

MIT.
